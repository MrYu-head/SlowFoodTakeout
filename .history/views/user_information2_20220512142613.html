<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet/less" href="../public/less/user_information.less">
    <script src="../node_modules/jquery/dist/jquery.min.js"></script>
    <script src="../node_modules/less/dist/less.min.js"></script>
</head>
<body>
    <!-- 个人信息管理界面，展示当前登录的用户的个人信息，包括手机号、密码、收货地址等。 -->
    <div class="container" id="container">
        <div class="mainBox" id="mainBox">
            <ul class="user_main" id="user_main">
                <li class="main_inform_img"><span class="main_img" id="main_img"><img src="../public/img/right_toolBsr_img/user_avatar.png" alt=""></span></li>
                <li class="main_inform">
                    <input type="button" onclick="submitBtn()" value="显示数据">
                </li>
                <li class="main_inform">
                    <p class="phoneNum" id="phoneNum">手机号</p>
                    <!-- <p class="phone" id="phone"></p> -->
                    <input type="number" id="phone" class="inputText" readonly="readonly" name="phone">
                </li>
                <li class="changeTab">
                    <input id="edit" class="clickBtn" type="submit" value="编辑">
                    <input id="confirm" class="clickBtn" type="submit" value="确认">
                    <input id="cancle" class="clickBtn" type="submit" value="取消">
                </li>
                <li class="main_inform">
                    <p class="passwordNum" id="passwordNum">密码</p>
                    <!-- <p class="password" id="password"></p> -->
                    <input type="password" id="password" class="inputText" readonly="readonly" name="password">
                </li>
                <li class="changeTab">
                    <input id="edit2" class="clickBtn" type="submit" value="编辑">
                    <input id="confirm2" class="clickBtn" type="submit" value="确认">
                    <input id="cancle2" class="clickBtn" type="submit" value="取消">
                </li>
                <li class="main_inform">
                    <p class="addressText" id="addressText">收货地址</p>
                    <!-- <p class="address" id="address"></p> -->
                    <input type="text" id="address" class="inputText" readonly="readonly" name="address">
                </li>
                <li class="changeTab">
                    <input id="edit3" class="clickBtn" type="submit" value="编辑">
                    <input id="confirm3" class="clickBtn" type="submit" value="确认">
                    <input id="cancle3" class="clickBtn" type="submit" value="取消">
                </li>
            </ul>
        </div>
    </div>
    <script type="text/javascript">
        // 1.从登陆界面发送的url获取到发送来的当前登录的用户的手机号
        // var phone2 = 
        $(function(){
            $('#phone').val(oneValues())
        })
        function oneValues(){
            var result;
            var url = window.location.search
            if(url.indexOf("?") != -1){
                result = url.substr(url.indexOf("=") + 1)
            }
            return result
        }

        // 2.只需要获取到当前登录用户的手机号，然后根据手机号从数据库中查询对应用户的密码和收货地址展示在html中
        function submitBtn(){
            var oldPhone = oneValues();
        // $(function(){
            $.ajax({
                type : "post",
                url : "/user_inform_search",
                data : {
                    phone : $('#phone').val()
                },
                success : function(res,data){
                    if(res.code == 1){
                        alert("这是密码："+res.message1 + "这是收货地址：" +res.message2)
                        // 1.首先获取到原先展示的信息
                        var originPhone = $("#phone").val()
                        // alert("这是originPhone" + originPhone)
                        var pwd = document.getElementById("password")
                        pwd.value = res.message1
                        var oldPassword = pwd.value
                        // alert("这是原始的获取到的密码：：" + oldPassword)
                        var add = document.getElementById("address")
                        add.value = res.message2
                        var oldAddress = add.value
                        // alert("这是原始的获取到的收货地址：：" + oldAddress)

                        // 2.手机号的点击按钮事件
                        $('#edit1').click(function(){
                            // 2.2把原来的文本覆盖，填充原文到value
                            var phone = document.getElementById("phone")
                            phone.readOnly = false;
                            // 修改信息后，点击保存按钮，将修改后的数据发送到app.js进行更新数据库的操作
                            $('#confirm1').click(function(){
                                $.ajax({
                                    type:"post",
                                    url:"/user_inform_update?phone",
                                    timeout : 3000,
                                    data:{
                                        oldPhone : oldPhone,
                                        phoneChange : $("#phone").val()
                                    },
                                    success : function(res){
                                        if(res.code == 1){
                                            alert(res.message)
                                            $('#phone').val() = phoneChange
                                        }else{
                                            alert(res.message)
                                        }
                                    },
                                    error : function(){
                                        // console.info("网络出错。")
                                        // alert("看到这里，就是修改失败了，请重试。。。")
                                        return
                                    }
                                })
                            })
                        });
                        // 2.6取消按钮点击事件
                        $('#cancle1').click(function(){
                            // 点击取消按钮，把input变为不可编辑，并且轻质刚刚编辑的内容
                            $('#edit1').attr('value','编辑')
                            // 2.8将原来的文本填充，覆盖
                            $('#phone').html(originPhone)
                        });


                        // var pwd = document.getElementById("password")
                        // pwd.value = res.message1
                        // var oldPassword = pwd.value
                        // alert("这是原始的密码：：" + oldPassword)
                        // 3.密码的点击修改事件
                        $('#edit2').click(function(){
                            var password = document.getElementById("password")
                            password.readOnly = false;
                            var PasswordChange = $('#password').val()
                            $('#confirm2').click(function(){
                                $.ajax({
                                    type:"post",
                                    url:"/user_inform_update/password",
                                    timeout : 3000,
                                    data:{
                                        oldPhone : oldPhone,
                                        oldPassword : oldPassword,
                                        PasswordChange : $("#password").val()
                                    },
                                    success : function(res){
                                        if(res.code == 1){
                                            alert(res.message)
                                            $('#Password').val() = PasswordChange
                                        }else{
                                            alert(res.message)
                                        }
                                    },
                                    error : function(){
                                        return
                                    }
                                })
                            })
                        });
                        $('#cancle2').click(function(){
                            $('#edit2').attr('value','编辑')
                            $('#password').html(originPassword)
                        });
                        // var add = document.getElementById("address")
                        // add.value = res.message2
                        // var oldAddress = add.value
                        // alert("这是原始的收货地址：：" + oldAddress)
                        // 4.收货地址的点击修改事件
                        $('#edit3').click(function(){
                            var address = document.getElementById("address")
                            address.readOnly = false;
                            // alert("这是上边发送来的收货地址：" + oldAddress)
                            $('#confirm3').click(function(){
                                $.ajax({
                                    type:"post",
                                    url:"/user_inform_update/address",
                                    timeout : 3000,
                                    data:{
                                        oldPhone : oldPhone,
                                        oldAddress : oldAddress,
                                        AddressChange : $("#address").val()
                                    },
                                    success : function(res){
                                        if(res.code == 1){
                                            alert(res.message)
                                            $('#Address').val() = AddressChange
                                        }else{
                                            alert(res.message)
                                        }
                                    },
                                    error : function(){
                                        // alert("看到这里，就是修改失败了，请重试。。。")
                                        return
                                    }
                                })
                            })
                        });
                        $('#cancle3').click(function(){
                            $('#edit3').attr('value','编辑')
                            $('#address').html(originAddress)
                        });

                    }else{
                        alert(res.message)
                    }
                },
                error : function(){
                    alert("出错，请重试。。")
                }
            })
        // })
        }

        




    </script>
</body>
</html>